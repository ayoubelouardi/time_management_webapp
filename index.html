<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Time Planner</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* A light gray background */
        }
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Simple animation for modals and blocks */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        /* Style for completed tasks */
        .task-completed span {
            text-decoration: line-through;
            color: #6b7280; /* Gray text for completed tasks */
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <!-- Main Application Container -->
    <div id="app" class="container mx-auto max-w-4xl p-4 sm:p-6 lg:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900">üóìÔ∏è Daily Time Planner</h1>
            <p class="text-lg text-gray-600 mt-2">Structure your day, budget your time, and get things done.</p>
        </header>

        <!-- Section 1: Day Setup (Visible initially or when no day is set) -->
        <div id="setup-section" class="bg-white p-6 rounded-xl shadow-md">
            <h2 class="text-2xl font-semibold mb-4 text-center">Define Your Day</h2>
            <div class="flex flex-col sm:flex-row gap-4 items-center justify-center">
                <div class="w-full sm:w-auto">
                    <label for="wake-up-time" class="block text-sm font-medium text-gray-700">Wake-up Time</label>
                    <input type="time" id="wake-up-time" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" value="07:00">
                </div>
                <div class="w-full sm:w-auto">
                    <label for="sleep-time" class="block text-sm font-medium text-gray-700">Sleep Time</label>
                    <input type="time" id="sleep-time" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" value="23:00">
                </div>
                <button id="set-day-btn" class="w-full sm:w-auto mt-4 sm:mt-6 px-6 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Set Day</button>
            </div>
             <button id="reset-day-btn" class="w-full sm:w-auto mt-4 px-6 py-2 border border-red-500 text-base font-medium rounded-md shadow-sm text-red-500 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-400 hidden">Reset Day Plan</button>
        </div>

        <!-- Section 2: Main Planner (Hidden until day is set) -->
        <div id="planner-section" class="hidden">
            <!-- Time Stats Display -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 text-center">
                <div class="bg-green-100 text-green-800 p-4 rounded-lg shadow">
                    <h3 class="font-bold text-lg">Total Time</h3>
                    <p id="total-time-display" class="text-2xl font-semibold"></p>
                </div>
                <div class="bg-blue-100 text-blue-800 p-4 rounded-lg shadow">
                    <h3 class="font-bold text-lg">Allocated</h3>
                    <p id="allocated-time-display" class="text-2xl font-semibold"></p>
                </div>
                <div class="bg-yellow-100 text-yellow-800 p-4 rounded-lg shadow">
                    <h3 class="font-bold text-lg">Remaining</h3>
                    <p id="remaining-time-display" class="text-2xl font-semibold"></p>
                </div>
            </div>

            <!-- Block Creation -->
            <div class="text-center mb-8">
                <button id="add-block-btn" class="px-8 py-3 border border-transparent text-base font-medium rounded-full shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    + Add Time Block
                </button>
            </div>

            <!-- Blocks Container -->
            <div id="blocks-container" class="space-y-6">
                <!-- Time blocks will be dynamically inserted here -->
            </div>
        </div>

    </div>

    <!-- Modal for adding a new block -->
    <div id="add-block-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white fade-in">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Create a New Time Block</h3>
                <div class="mt-2 px-7 py-3">
                    <input type="text" id="block-purpose-input" placeholder="Purpose (e.g., Morning Routine)" class="mb-3 px-3 py-2 text-gray-900 placeholder-gray-500 border border-gray-300 rounded-md w-full focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    <input type="number" id="block-duration-input" placeholder="Duration (in minutes)" class="px-3 py-2 text-gray-900 placeholder-gray-500 border border-gray-300 rounded-md w-full focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div class="items-center px-4 py-3">
                    <button id="save-block-btn" class="px-4 py-2 bg-indigo-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-300">
                        Save Block
                    </button>
                     <button id="cancel-block-btn" class="mt-2 px-4 py-2 bg-gray-200 text-gray-800 text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for task details -->
    <div id="task-details-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-lg shadow-lg rounded-md bg-white fade-in">
            <div class="mt-3">
                <h3 class="text-lg leading-6 font-medium text-gray-900" id="task-modal-title">Task Details</h3>
                <div class="mt-4 space-y-4">
                    <div>
                        <label for="task-notes-input" class="block text-sm font-medium text-gray-700">Notes & Comments</label>
                        <textarea id="task-notes-input" rows="4" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Add any relevant details here..."></textarea>
                    </div>
                </div>
                <div class="items-center px-4 py-3 mt-4 text-right">
                    <button id="save-task-details-btn" class="px-4 py-2 bg-indigo-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-300">
                        Save Details
                    </button>
                    <button id="cancel-task-details-btn" class="ml-2 px-4 py-2 bg-gray-200 text-gray-800 text-base font-medium rounded-md shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Application Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM ELEMENT REFERENCES ---
            const setupSection = document.getElementById('setup-section');
            const plannerSection = document.getElementById('planner-section');
            const wakeUpInput = document.getElementById('wake-up-time');
            const sleepInput = document.getElementById('sleep-time');
            const setDayBtn = document.getElementById('set-day-btn');
            const resetDayBtn = document.getElementById('reset-day-btn');
            
            const totalTimeDisplay = document.getElementById('total-time-display');
            const allocatedTimeDisplay = document.getElementById('allocated-time-display');
            const remainingTimeDisplay = document.getElementById('remaining-time-display');
            
            const addBlockBtn = document.getElementById('add-block-btn');
            const blocksContainer = document.getElementById('blocks-container');

            // Modals
            const addBlockModal = document.getElementById('add-block-modal');
            const blockPurposeInput = document.getElementById('block-purpose-input');
            const blockDurationInput = document.getElementById('block-duration-input');
            const saveBlockBtn = document.getElementById('save-block-btn');
            const cancelBlockBtn = document.getElementById('cancel-block-btn');

            const taskDetailsModal = document.getElementById('task-details-modal');
            const taskModalTitle = document.getElementById('task-modal-title');
            const taskNotesInput = document.getElementById('task-notes-input');
            const saveTaskDetailsBtn = document.getElementById('save-task-details-btn');
            const cancelTaskDetailsBtn = document.getElementById('cancel-task-details-btn');

            // --- APPLICATION STATE ---
            let state = {
                dayIsSet: false,
                wakeTime: '07:00',
                sleepTime: '23:00',
                blocks: [],
                editingTaskId: null, // format: { blockId, taskId }
            };

            // --- UTILITY FUNCTIONS ---
            const timeToMinutes = (timeStr) => {
                const [hours, minutes] = timeStr.split(':').map(Number);
                return hours * 60 + minutes;
            };

            const minutesToHM = (minutes) => {
                if (minutes < 0) minutes = 0;
                const h = Math.floor(minutes / 60);
                const m = minutes % 60;
                return `${h}h ${m}m`;
            };

            const minutesToTime = (minutes) => {
                const h = Math.floor(minutes / 60) % 24;
                const m = minutes % 60;
                return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
            };
            
            // --- STATE MANAGEMENT & PERSISTENCE ---
            const saveState = () => {
                localStorage.setItem('timePlannerState', JSON.stringify(state));
            };

            const loadState = () => {
                const savedState = localStorage.getItem('timePlannerState');
                if (savedState) {
                    state = JSON.parse(savedState);
                }
            };
            
            // --- RENDERING & UI UPDATES ---
            const render = () => {
                if (state.dayIsSet) {
                    setupSection.classList.add('hidden');
                    plannerSection.classList.remove('hidden');
                    resetDayBtn.classList.remove('hidden');
                    wakeUpInput.value = state.wakeTime;
                    sleepInput.value = state.sleepTime;
                } else {
                    setupSection.classList.remove('hidden');
                    plannerSection.classList.add('hidden');
                    resetDayBtn.classList.add('hidden');
                }
                
                renderTimeStats();
                renderBlocks();
            };
            
            const renderTimeStats = () => {
                let totalMinutes = timeToMinutes(state.sleepTime) - timeToMinutes(state.wakeTime);
                if (totalMinutes < 0) { // Handles overnight case
                    totalMinutes += 24 * 60;
                }
                const allocatedMinutes = state.blocks.reduce((sum, block) => sum + block.duration, 0);
                const remainingMinutes = totalMinutes - allocatedMinutes;
                
                totalTimeDisplay.textContent = minutesToHM(totalMinutes);
                allocatedTimeDisplay.textContent = minutesToHM(allocatedMinutes);
                remainingTimeDisplay.textContent = minutesToHM(remainingMinutes);

                // Disable add block button if no time is left
                addBlockBtn.disabled = remainingMinutes <= 0;
                addBlockBtn.classList.toggle('opacity-50', remainingMinutes <= 0);
                addBlockBtn.classList.toggle('cursor-not-allowed', remainingMinutes <= 0);
            };

            const renderBlocks = () => {
                blocksContainer.innerHTML = '';
                let cumulativeTime = timeToMinutes(state.wakeTime);

                state.blocks.forEach(block => {
                    const blockEl = document.createElement('div');
                    blockEl.className = 'bg-white p-5 rounded-lg shadow-md fade-in';
                    blockEl.dataset.id = block.id;

                    const startTime = minutesToTime(cumulativeTime);
                    cumulativeTime += block.duration;
                    const endTime = minutesToTime(cumulativeTime);

                    let tasksHtml = block.tasks.map(task => `
                        <li class="flex items-center justify-between py-2 border-b" data-id="${task.id}">
                            <div class="flex items-center flex-grow">
                                <input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 task-checkbox" ${task.completed ? 'checked' : ''}>
                                <span class="ml-3 text-gray-800 flex-grow cursor-pointer task-text">${task.text}</span>
                            </div>
                            <button class="text-red-500 hover:text-red-700 font-semibold ml-2 delete-task-btn">Delete</button>
                        </li>
                    `).join('');
                    
                    blockEl.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-indigo-700">${block.purpose}</h3>
                                <p class="text-sm text-gray-500">${minutesToHM(block.duration)} (${startTime} - ${endTime})</p>
                            </div>
                            <button class="text-red-600 hover:text-red-800 font-bold delete-block-btn">‚úï</button>
                        </div>
                        <ul class="task-list space-y-2 mb-4">${tasksHtml}</ul>
                        <div class="flex gap-2 mt-4">
                            <input type="text" class="flex-grow px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 new-task-input" placeholder="Add a new task...">
                            <button class="px-4 py-2 border border-transparent font-medium rounded-md shadow-sm text-white bg-indigo-500 hover:bg-indigo-600 add-task-btn">Add</button>
                        </div>
                    `;
                    blocksContainer.appendChild(blockEl);
                });
            };

            // --- MODAL HANDLING ---
            const openModal = (modal) => modal.classList.remove('hidden');
            const closeModal = (modal) => modal.classList.add('hidden');

            // --- EVENT HANDLERS ---
            setDayBtn.addEventListener('click', () => {
                state.dayIsSet = true;
                state.wakeTime = wakeUpInput.value;
                state.sleepTime = sleepInput.value;
                saveState();
                render();
            });

            resetDayBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to reset your entire day plan? This cannot be undone.')) {
                    state.dayIsSet = false;
                    state.blocks = [];
                    saveState();
                    render();
                }
            });

            addBlockBtn.addEventListener('click', () => {
                blockPurposeInput.value = '';
                blockDurationInput.value = '';
                openModal(addBlockModal);
                blockPurposeInput.focus();
            });

            cancelBlockBtn.addEventListener('click', () => closeModal(addBlockModal));
            
            saveBlockBtn.addEventListener('click', () => {
                const purpose = blockPurposeInput.value.trim();
                const duration = parseInt(blockDurationInput.value, 10);
                if (!purpose || isNaN(duration) || duration <= 0) {
                    alert('Please enter a valid purpose and duration.');
                    return;
                }

                state.blocks.push({
                    id: Date.now(),
                    purpose,
                    duration,
                    tasks: []
                });

                saveState();
                render();
                closeModal(addBlockModal);
            });

            blocksContainer.addEventListener('click', (e) => {
                const blockEl = e.target.closest('[data-id]');
                if (!blockEl) return;
                const blockId = Number(blockEl.dataset.id);

                // Delete Block
                if (e.target.matches('.delete-block-btn')) {
                    state.blocks = state.blocks.filter(b => b.id !== blockId);
                    saveState();
                    render();
                }

                // Add Task
                if (e.target.matches('.add-task-btn')) {
                    const input = blockEl.querySelector('.new-task-input');
                    const taskText = input.value.trim();
                    if (taskText) {
                        const block = state.blocks.find(b => b.id === blockId);
                        block.tasks.push({
                            id: Date.now(),
                            text: taskText,
                            completed: false,
                            notes: ''
                        });
                        input.value = '';
                        saveState();
                        render();
                    }
                }
                
                const taskEl = e.target.closest('li[data-id]');
                if (!taskEl) return;
                const taskId = Number(taskEl.dataset.id);

                // Delete Task
                if (e.target.matches('.delete-task-btn')) {
                    const block = state.blocks.find(b => b.id === blockId);
                    block.tasks = block.tasks.filter(t => t.id !== taskId);
                    saveState();
                    render();
                }

                // Toggle Task Completion
                if (e.target.matches('.task-checkbox')) {
                    const block = state.blocks.find(b => b.id === blockId);
                    const task = block.tasks.find(t => t.id === taskId);
                    task.completed = e.target.checked;
                    taskEl.classList.toggle('task-completed', task.completed);
                    saveState();
                }

                // Open Task Details Modal
                if (e.target.matches('.task-text')) {
                    const block = state.blocks.find(b => b.id === blockId);
                    const task = block.tasks.find(t => t.id === taskId);
                    state.editingTaskId = { blockId, taskId };
                    taskModalTitle.textContent = `Details for: "${task.text}"`;
                    taskNotesInput.value = task.notes || '';
                    openModal(taskDetailsModal);
                }
            });

            saveTaskDetailsBtn.addEventListener('click', () => {
                const { blockId, taskId } = state.editingTaskId;
                const block = state.blocks.find(b => b.id === blockId);
                const task = block.tasks.find(t => t.id === taskId);
                task.notes = taskNotesInput.value.trim();
                
                saveState();
                closeModal(taskDetailsModal);
                state.editingTaskId = null;
            });

            cancelTaskDetailsBtn.addEventListener('click', () => {
                closeModal(taskDetailsModal);
                state.editingTaskId = null;
            });
            
            // --- INITIALIZATION ---
            loadState();
            render();
        });
    </script>
</body>
</html>
